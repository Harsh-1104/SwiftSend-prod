<!DOCTYPE html>
<html lang="en" data-layout="vertical" data-topbar="light" data-sidebar="dark" data-sidebar-size="lg"
	data-sidebar-image="none" data-preloader="disable">

<head>
	<meta charset="utf-8" />
	<title>Dashboard | SwiftSends</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<meta content="Bulk message services" name="description" />
	<meta content="Gajjar Harsh" name="author" />

	<!-- App favicon -->
	<link rel="shortcut icon" href="/assets/images/favicon.ico" />

	<!-- jsvectormap css -->
	<link href="/assets/libs/jsvectormap/css/jsvectormap.min.css" rel="stylesheet" type="text/css" />

	<!--Swiper slider css-->
	<link href="/assets/libs/swiper/swiper-bundle.min.css" rel="stylesheet" type="text/css" />

	<!-- Layout config Js -->
	<script src="/assets/js/layout.js"></script>
	<!-- Bootstrap Css -->
	<link href="/assets/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
	<!-- Icons Css -->
	<link href="/assets/css/icons.min.css" rel="stylesheet" type="text/css" />
	<!-- App Css-->
	<link href="/assets/css/app.min.css" rel="stylesheet" type="text/css" />
	<!-- custom Css-->
	<link href="/assets/css/custom.min.css" rel="stylesheet" type="text/css" />
</head>

<body>
	<!-- Begin page -->
	<div id="layout-wrapper">
		<header id="page-topbar">
			<div class="layout-width">
				<div class="navbar-header">
					<div class="d-flex">
						<!-- LOGO -->
						<div class="navbar-brand-box horizontal-logo">
							<a href="/" class="logo logo-dark">
								<span class="logo-sm">
									<img src="/assets/images/logo-sm.svg" alt="" height="60" />
								</span>
								<span class="logo-lg">
									<img src="/assets/images/logo-dark.svg" alt="" height="100" width="200" />
								</span>
							</a>


							<a href="/" class="logo logo-light">
								<span class="logo-sm">
									<img src="/assets/images/logo-sm.svg" alt="" height="60" />
								</span>
								<span class="logo-lg">
									<img src="/assets/images/logo-light.svg" alt="" height="100" width="200" />
								</span>
							</a>
						</div>

						<button type="button"
							class="btn btn-sm px-3 fs-16 header-item vertical-menu-btn topnav-hamburger"
							id="topnav-hamburger-icon">
							<span class="hamburger-icon">
								<span></span>
								<span></span>
								<span></span>
							</span>
						</button>
					</div>

					<div class="d-flex align-items-center">
						<div class="dropdown d-md-none topbar-head-dropdown header-item">
							<button type="button" class="btn btn-icon btn-topbar btn-ghost-secondary rounded-circle"
								id="page-header-search-dropdown" data-bs-toggle="dropdown" aria-haspopup="true"
								aria-expanded="false">
								<i class="bx bx-search fs-22"></i>
							</button>
							<div class="dropdown-menu dropdown-menu-lg dropdown-menu-end p-0"
								aria-labelledby="page-header-search-dropdown">
								<form class="p-3">
									<div class="form-group m-0">
										<div class="input-group">
											<input type="text" class="form-control" placeholder="Search ..."
												aria-label="Recipient's username" />
											<button class="btn btn-primary" type="submit">
												<i class="mdi mdi-magnify"></i>
											</button>
										</div>
									</div>
								</form>
							</div>
						</div>

						<div class="ms-1 header-item">
							<button type="button" class="btn btn-icon btn-topbar btn-ghost-secondary rounded-circle"
								data-toggle="fullscreen">
								<i class="bx bx-fullscreen fs-22"></i>
							</button>
						</div>

						<div class="ms-1 header-item">
							<button type="button"
								class="btn btn-icon btn-topbar btn-ghost-secondary rounded-circle light-dark-mode">
								<i class="bx bx-moon fs-22"></i>
							</button>
						</div>

						<div class="dropdown ms-sm-3 header-item topbar-user">
							<button type="button" class="btn" id="page-header-user-dropdown" data-bs-toggle="dropdown"
								aria-haspopup="true" aria-expanded="false">
								<span class="d-flex align-items-center">
									<img class="rounded-circle header-profile-user profileimg" />
									<span class="text-start ms-xl-2">
										<span
											class="d-none d-xl-inline-block ms-1 fw-medium user-name-text profilename"></span>
										<span class="d-none d-xl-block ms-1 fs-12 text-muted user-name-sub-text">
											Founder
										</span>
									</span>
								</span>
							</button>
							<div class="dropdown-menu dropdown-menu-end">
								<!-- item-->
								<h6 class="dropdown-header">
									Welcome <span class="profilename"></span>
								</h6>
								<a class="dropdown-item" href="/profile">
									<i class="mdi mdi-account-circle text-muted fs-16 align-middle me-1"></i>
									<span class="align-middle">Profile</span>
								</a>
								<a class="dropdown-item" href="/subscription">
									<i class="mdi mdi-credit-card-chip text-muted fs-16 align-middle me-1"></i>
									<span class="align-middle">Pay</span>
								</a>
								<div class="dropdown-divider"></div>
								<a class="dropdown-item" id="logout">
									<i class="mdi mdi-logout text-muted fs-16 align-middle me-1"></i>
									<span class="align-middle" data-key="t-logout">Logout</span>
								</a>
							</div>
						</div>
					</div>
				</div>
			</div>
		</header>
		<!-- ========== App Menu ========== -->
		<div class="app-menu navbar-menu">
			<!-- LOGO -->
			<div class="navbar-brand-box">
				<!-- Dark Logo-->

				<a href="/" class="logo logo-dark">
					<span class="logo-sm">
						<img src="/assets/images/logo-sm.svg" alt="" height="60" />
					</span>
					<span class="logo-lg">
						<img src="/assets/images/logo-dark.svg" alt="" height="100" width="200" />
					</span>
				</a>
				<!-- Light Logo-->
				<a href="/" class="logo logo-light">
					<span class="logo-sm">
						<img src="/assets/images/logo-sm.svg" alt="" height="60" />
					</span>
					<span class="logo-lg">
						<img src="/assets/images/logo-dark.svg" alt="" height="100" width="200" />
					</span>
				</a>
				<button type="button" class="btn btn-sm p-0 fs-20 header-item float-end btn-vertical-sm-hover"
					id="vertical-hover">
					<i class="ri-record-circle-line"></i>
				</button>
			</div>

			<div id="scrollbar">
				<div class="container-fluid">
					<div id="two-column-menu"></div>
					<ul class="navbar-nav" id="navbar-nav"></ul>
				</div>
			</div>

			<div class="sidebar-background"></div>
		</div>
		<!-- Left Sidebar End -->
		<!-- Vertical Overlay-->
		<div class="vertical-overlay"></div>

		<!-- ============================================================== -->
		<!-- Start right Content here -->
		<!-- ============================================================== -->
		<div class="main-content">
			<div class="page-content">
				<div class="container-fluid">
					<div class="page-title-box d-sm-flex align-items-center justify-content-between">
						<div class="page-title">
							<h3 class="text-center mb-0">Application stats</h3>
						</div>
					</div>
					<div class="row mb-4">
						<div class="col-6">
							<div class="d-flex align-items-center justify-content-start gap-3">
								<input type="text" id="time_period" class="form-control mr-3 w-100"
									data-provider="flatpickr" data-date-format="Y-m-d" data-range-date="true"
									placeholder="Select date Range">
								<button type="button" class="btn btn-primary" id="Filter">
									<i class="bx bx-search-alt-2 align-middle fs-5"></i>
								</button>
								<button class="btn btn-soft-danger w-20 d-none" type="button" id="clrfilter">
									<i class="ri-close-line align-bottom"></i> Clear
								</button>
							</div>
						</div>
					</div>

					<div class="tab-content text-muted">
						<div class="tab-pane active show" id="whatsappcount" role="tabpanel">
							<div class="record" id="record"></div>
						</div>
					</div>
				</div>
			</div>

			<footer class="footer"></footer>
		</div>
	</div>

	<!--start back-to-top-->
	<button onclick="topFunction()" class="btn btn-danger btn-icon" id="back-to-top">
		<i class="ri-arrow-up-line"></i>
	</button>
	<!--end back-to-top-->

	<!--preloader-->
	<div id="preloader">
		<div id="status">
			<div class="spinner-border text-primary avatar-sm" role="status">
				<span class="visually-hidden">Loading...</span>
			</div>
		</div>
	</div>

	<div class="customizer-setting" id="chatbot">
		<div class="btn-info btn-rounded shadow-lg btn btn-icon btn-lg p-2">
			<i class="mdi mdi-robot" id="iconchat"></i>
		</div>
	</div>

	<div class="email-chat-detail" id="emailchat-detailElem" style="display: none">
		<div class="card mb-0">
			<div class="card-header align-items-center d-flex bg-primary text-white-50">
				<div class="flex-grow-1">
					<h5 class="fs-15 text-white mb-1 profile-username">
						SwiftSend ChatBot
					</h5>
					<p class="mb-0 fs-12 lh-1">Ask here for help</p>
				</div>
				<div>
					<i class="fa-brands fa-bots fs-1 text-white"></i>
				</div>
			</div>

			<div class="card-body p-0">
				<div id="users-chat">
					<div class="chat-conversation p-3" id="chat-conversation" data-simplebar style="height: 250px">
						<ul class="list-unstyled chat-conversation-list chat-sm" id="conversation"></ul>
					</div>
				</div>

				<div class="border-top border-top-dashed">
					<div class="row g-2 mx-3 mt-2 mb-3">
						<div class="col">
							<div class="position-relative">
								<input type="text" class="form-control border-light bg-light message-input"
									placeholder="Enter Message..." id="input" />
							</div>
						</div>
						<div class="col-auto">
							<button class="btn btn-primary" id="sendbotmsg">
								<i class="mdi mdi-send"></i>
							</button>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<!-- voice input modal  -->
	<div id="voice_input" class="modal zoomIn">
		<div class="modal-dialog modal-dialog-centered">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" id="btn-voice-close" class="btn-close" data-bs-dismiss="modal"
						aria-label="Close">
					</button>
				</div>
				<div class="modal-body">
					<div class="fs-1 text-center" id="msg" style="resize: none;"></div>
				</div>
			</div>
		</div>
	</div>

	<!-- JAVASCRIPT -->
	<script src="/assets/js/jquery.js"></script>
	<script src="/assets/js/main.js"></script>
	<script src="/assets/js/validate.js"></script>
	<script src="/assets/js/chatbot.js"></script>
	<script src="/assets/js/voiceRecognition.js"></script>

	<script src="/assets/libs/bootstrap/js/bootstrap.bundle.min.js"></script>
	<script src="/assets/libs/simplebar/simplebar.min.js"></script>
	<script src="/assets/libs/node-waves/waves.min.js"></script>
	<script src="/assets/libs/feather-icons/feather.min.js"></script>
	<script src="/assets/js/pages/plugins/lord-icon-2.1.0.js"></script>
	<script src="/assets/js/plugins.js"></script>

	<!-- apexcharts -->
	<script src="/assets/libs/apexcharts/apexcharts.min.js"></script>

	<!-- Sweet Alerts js -->
	<script src="/assets/sweetalert2/sweet-alert.init.js"></script>
	<script src="/assets/sweetalert2/sweetalert2.all.js"></script>

	<!-- Vector map-->
	<script src="/assets/libs/jsvectormap/js/jsvectormap.min.js"></script>
	<script src="/assets/libs/jsvectormap/maps/world-merc.js"></script>

	<!--Swiper slider js-->
	<script src="/assets/libs/swiper/swiper-bundle.min.js"></script>

	<!-- Dashboard init -->
	<script src="/assets/js/pages/dashboard-ecommerce.init.js"></script>

	<!-- App js -->
	<script src="/assets/js/app.js"></script>

	<!-- prismjs plugin -->
	<script src="/assets/libs/prismjs/prism.js"></script>

	<script>
		$(document).ready(() => {
			chkLogin();

			function displayPieChart(count, id, type) {
				let options = {
					series: count,
					chart: {
						height: 250,
						width: 250,
						type: "pie",
					},
					legend: {
						show: false
					},
					dataLabels: {
						dropShadow: {
							enabled: 2
						}
					},
					colors: ['#405189', '#f06548', '#f7b84b', '#299cdb', '#0ab39c', '#3577f1', '#6559cc']
				}
				switch (type) {
					case 'whatsapp': {
						options['labels'] = [
							"Single Message",
							"Document Message",
							"Template Bulk Message",
							"Custom Bulk Messages",
							"Channel Bulk Message",
						];
						break;
					}

					case 'email': {
						options['labels'] = [
							"Template Bulk Mail",
							"Custom Bulk Mail",
							"Channel Bulk Mail",
						];
						break;
					}

					default: {
						options['labels'] = []
					}
				}
				chart = new ApexCharts(document.querySelector("#" + id), options).render();
			}

			function message_summary() {
				$.ajax({
					url: "/message_summary",
					method: "GET",
					success: function (val) {
						let output = ``;
						let obj = {};
						switch (val.status_code) {
							case '500': {
								InternalServerError();
								break;
							}
							case '404': {
								output += `<div class="text-center">
                                            <h5 class="p-3">
												No Message sent from any instance / No Instance created
                                            </h5>
                                            <a class="btn btn-soft-success" href="/instance">
                                                Create Instance
                                            </a>
                                        </div>`;
								break;
							}

							default: {
								output += `<div class="row">`;

								for (let i = 0; i < val.length; i++) {
									var countmsgarray = new Array();
									countmsgarray.push(val[i].single_message_count);
									countmsgarray.push(val[i].single_document_count);
									countmsgarray.push(val[i].bulk_message_template_count);
									countmsgarray.push(val[i].bulk_message_custom_count);
									countmsgarray.push(val[i].bulk_message_channel_count);
									obj[i] = countmsgarray;
									const total =
										val[i].single_message_count +
										val[i].single_document_count +
										val[i].bulk_message_template_count +
										val[i].bulk_message_custom_count +
										val[i].bulk_message_channel_count;
									output += `<div class="col-lg-4 col-md-6 col-sm-12">
													<div class="card card-animate">
														<div class="card-header">
															<div class="fw-medium text-primary fs-18">${val[i].i_name}</div>
														</div>
														<div id="id_${val[i].iid}" class="card-body">
															<div class="p-0 text-dark fs-15">
																<div id="message_chart_${i}" class="apex-charts" dir="ltr"></div>
																<div class="d-flex justify-content-between">
																	<span class="text-muted fw-medium">
																		<i class="ri-record-circle-fill text-primary align-middle"></i>
																		Single Message
																	</span>
																	<span class="text-primary fw-semibold">${val[i].single_message_count}</span>
																</div>
																<div class="d-flex justify-content-between">
																	<span class="text-muted fw-medium">
																		<i class="ri-record-circle-fill text-danger align-middle"></i>	
																		Document Message
																	</span>
																	<span class="text-primary fw-semibold">${val[i].single_document_count}</span>
																</div>
																<div class="d-flex justify-content-between">
																	<span class="text-muted fw-medium">
																		<i class="ri-record-circle-fill text-warning align-middle"></i>	
																		Template Bulk Message
																	</span>
																	<span class="text-primary fw-semibold">${val[i].bulk_message_template_count}</span>
																</div>
																<div class="d-flex justify-content-between">
																	<span class="text-muted fw-medium">
																		<i class="ri-record-circle-fill text-info align-middle"></i>	
																		Custom Bulk Message
																	</span>
																	<span class="text-primary fw-semibold">${val[i].bulk_message_custom_count}</span>
																</div>
																<div class="d-flex justify-content-between">
																	<span class="text-muted fw-medium">
																		<i class="ri-record-circle-fill text-success align-middle"></i>	
																		Channel Bulk Message
																	</span>
																	<span class="text-primary fw-semibold">${val[i].bulk_message_channel_count}</span>
																</div>
																<hr />
																<div class="d-flex justify-content-between">
																	<span class="text-muted fw-medium">Total</span>
																	<span class="text-primary fw-semibold">${total}</span>
																</div>
															</div>
														</div>
													</div>
												</div>`;
								}
								output += `</div>`;
							}
						}
						$('#record').html(output);
						for (let i = 0; i < Object.keys(obj).length; i++) {
							displayPieChart(obj[i], `message_chart_${i}`, "whatsapp");
						}
					}
				})
			}
			message_summary();

			function message_filter(startDate, endDate) {
				$.ajax({
					url: "/message_filter",
					method: "POST",
					data: {
						startdate: startDate,
						enddate: endDate
					},
					success: function (val) {
						let output = ``;
						let obj = {};
						switch (val.status_code) {
							case '500': {
								InternalServerError();
								break;
							}
							case '404': {
								output += `<div class="text-center">
                                            <h5 class="p-3">
												No Message sent from any instance / No Instance created
                                            </h5>
                                            <a class="btn btn-soft-success" href="/instance">
                                                Create Instance
                                            </a>
                                        </div>`;
								break;
							}

							default: {
								output += `<div class="row">`;

								for (let i = 0; i < val.length; i++) {
									var countmsgarray = new Array();
									countmsgarray.push(val[i].single_message_count);
									countmsgarray.push(val[i].single_document_count);
									countmsgarray.push(val[i].bulk_message_template_count);
									countmsgarray.push(val[i].bulk_message_custom_count);
									countmsgarray.push(val[i].bulk_message_channel_count);
									obj[i] = countmsgarray;
									const total =
										val[i].single_message_count +
										val[i].single_document_count +
										val[i].bulk_message_template_count +
										val[i].bulk_message_custom_count +
										val[i].bulk_message_channel_count;
									output += `<div class="col-lg-4 col-md-6 col-sm-12">
													<div class="card card-animate">
														<div class="card-header">
															<div class="fw-medium text-primary fs-18">${val[i].i_name}</div>
														</div>
														<div id="id_${val[i].iid}" class="card-body">
															<div class="p-0 text-dark fs-15">
																<div id="message_chart_${i}" class="apex-charts" dir="ltr"></div>
																<div class="d-flex justify-content-between">
																	<span class="text-muted fw-medium">
																		<i class="ri-record-circle-fill text-primary align-middle"></i>
																		Single Message
																	</span>
																	<span class="text-primary fw-semibold">${val[i].single_message_count}</span>
																</div>
																<div class="d-flex justify-content-between">
																	<span class="text-muted fw-medium">
																		<i class="ri-record-circle-fill text-danger align-middle"></i>	
																		Document Message
																	</span>
																	<span class="text-primary fw-semibold">${val[i].single_document_count}</span>
																</div>
																<div class="d-flex justify-content-between">
																	<span class="text-muted fw-medium">
																		<i class="ri-record-circle-fill text-warning align-middle"></i>	
																		Template Bulk Message
																	</span>
																	<span class="text-primary fw-semibold">${val[i].bulk_message_template_count}</span>
																</div>
																<div class="d-flex justify-content-between">
																	<span class="text-muted fw-medium">
																		<i class="ri-record-circle-fill text-info align-middle"></i>	
																		Custom Bulk Message
																	</span>
																	<span class="text-primary fw-semibold">${val[i].bulk_message_custom_count}</span>
																</div>
																<div class="d-flex justify-content-between">
																	<span class="text-muted fw-medium">
																		<i class="ri-record-circle-fill text-success align-middle"></i>	
																		Channel Bulk Message
																	</span>
																	<span class="text-primary fw-semibold">${val[i].bulk_message_channel_count}</span>
																</div>
																<hr />
																<div class="d-flex justify-content-between">
																	<span class="text-muted fw-medium">Total</span>
																	<span class="text-primary fw-semibold">${total}</span>
																</div>
															</div>
														</div>
													</div>
												</div>`;
								}
								output += `</div>`;
							}
						}
						$('#record').html(output);
						for (let i = 0; i < Object.keys(obj).length; i++) {
							displayPieChart(obj[i], `message_chart_${i}`, "whatsapp");
						}
					}
				})
			}

			$(document).on("click", "#Filter", function () {
				const timePeriodValue = $("#time_period").val();

				if (timePeriodValue != "" || timePeriodValue != '') {
					const timePeriodArray = timePeriodValue.split('to');
					const startDate = timePeriodArray[0].trim();
					const endDate = timePeriodArray[1].trim();

					$('#clrfilter').removeClass('d-none');

					message_filter(startDate, endDate);
				}
			})

			$(document).on('click', '#clrfilter', function () {
				$("#time_period").val("")
				$('#clrfilter').addClass('d-none');

				message_summary();
			});
		});
	</script>
</body>

</html>